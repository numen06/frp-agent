# 分组管理功能使用指南

## 📖 功能概述

本系统提供了完善的代理分组管理功能，支持自动分析和手动管理两种方式。

### 核心特性
- ✅ **自动分组识别**：从代理名称自动解析分组（如 `dlyy_rdp` → 分组 `dlyy`）
- ✅ **默认分组**：无法识别的代理自动归类为"其他"
- ✅ **手动管理**：管理员可手动调整代理分组
- ✅ **批量操作**：支持批量修改多个代理的分组
- ✅ **分组重命名**：一键重命名整个分组
- ✅ **分组过滤**：按分组快速筛选代理列表

---

## 🔧 自动分组规则

### 分组命名规则
代理名称格式：`{分组名}_{功能描述}`

**示例：**
```
dlyy_rdp        → 分组: dlyy
dlyy_ssh        → 分组: dlyy
test_web        → 分组: test
myapp_api       → 分组: myapp
standalone      → 分组: 其他（无下划线）
_test           → 分组: 其他（下划线前为空）
```

### 自动解析逻辑
1. 如果代理名称包含下划线 `_`
   - 提取第一个下划线前的部分作为分组名
   - 如果提取结果为空，归类为"其他"
2. 如果代理名称不包含下划线
   - 直接归类为"其他"

---

## 📋 手动管理功能

### 1. 批量修改分组

**步骤：**
1. 点击"📁 管理分组"按钮
2. 选择"批量修改分组"标签
3. 按分组展示的代理列表中勾选需要修改的代理
   - 可点击分组标题勾选整个分组
   - 可单独勾选特定代理
4. 输入新分组名称（留空则为"其他"）
5. 点击"批量更新"按钮
6. 确认操作

**使用场景：**
- 将多个代理从"其他"分组移动到特定分组
- 调整错误分类的代理
- 合并多个分组的代理

### 2. 重命名分组

**步骤：**
1. 点击"📁 管理分组"按钮
2. 选择"重命名分组"标签
3. 从下拉列表选择要重命名的分组
4. 输入新分组名称
5. 点击"重命名分组"按钮
6. 确认操作

**效果：**
- 该分组下的所有代理将被更新到新分组
- 适用于分组名称调整或规范化

### 3. 分组过滤

**步骤：**
1. 在代理列表页面顶部选择"分组"下拉框
2. 选择要查看的分组
3. 列表自动过滤显示该分组的代理

**功能：**
- 快速定位特定分组的代理
- 支持与状态过滤组合使用
- 实时显示过滤结果统计

---

## 🎯 实际使用示例

### 示例1：整理混乱的代理列表

**场景：**  
新系统导入了28个代理，全部被归类为"其他"

**操作：**
1. 查看代理列表，识别代理命名模式
2. 点击"📁 管理分组"
3. 勾选所有 `dlyy_*` 开头的代理
4. 输入分组名 `dlyy`，批量更新
5. 重复操作整理其他分组

**结果：**
- dlyy 分组：15个代理
- test 分组：8个代理  
- prod 分组：3个代理
- 其他：2个代理

### 示例2：按分组生成frpc配置

**场景：**  
需要为 `dlyy` 分组的所有代理生成frpc配置

**操作：**
1. 分组过滤选择 `dlyy`
2. 点击"⚙️ 生成配置"
3. 选择要生成的分组
4. 生成配置文件或安装脚本

**生成内容：**
```ini
[common]
server_addr = frp.example.com
server_port = 7000

[dlyy_rdp]
type = tcp
local_ip = 127.0.0.1
local_port = 3389
remote_port = 13389

[dlyy_ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 10022
```

### 示例3：重命名分组

**场景：**  
分组名 `test` 需要改为 `staging`

**操作：**
1. 点击"📁 管理分组"
2. 切换到"重命名分组"标签
3. 选择 `test` 分组
4. 输入新名称 `staging`
5. 确认重命名

**结果：**
- 所有 `test` 分组的代理自动更新为 `staging`
- 分组过滤器自动更新
- 配置生成使用新分组名

---

## 🔄 与frps数据同步

### 同步行为
当从frps拉取新代理时：
1. 自动解析代理名称
2. 确定分组（按命名规则）
3. 创建代理记录
4. 如果无法识别，归类为"其他"

### 本地数据优先
- 本地数据库是主数据源
- 手动修改的分组不会被同步覆盖
- frps可能丢失数据，本地保持完整

---

## 📊 API接口

### 获取分组列表
```bash
GET /api/groups?frps_server_id={id}

响应：
{
  "groups": [
    {
      "group_name": "dlyy",
      "total_count": 15,
      "online_count": 12,
      "offline_count": 3
    },
    ...
  ]
}
```

### 批量更新分组
```bash
PUT /api/groups/batch-update

请求体：
{
  "proxy_ids": [1, 2, 3, 4],
  "group_name": "new_group"
}
```

### 重命名分组
```bash
POST /api/groups/rename

请求体：
{
  "old_name": "test",
  "new_name": "staging",
  "frps_server_id": 1
}
```

### 按分组生成配置
```bash
GET /api/frpc/config/by-group/{group_name}?frps_server_id={id}
```

---

## 💡 最佳实践

### 1. 命名规范
建议统一代理命名格式：
- 生产环境：`prod_{service}_type`
- 测试环境：`test_{service}_type`
- 开发环境：`dev_{service}_type`

**示例：**
```
prod_web_http
prod_api_tcp
test_db_tcp
dev_app_rdp
```

### 2. 分组策略
- 按环境分组：`prod`, `test`, `dev`
- 按项目分组：`project_a`, `project_b`
- 按客户分组：`client_x`, `client_y`
- 按服务分组：`web`, `api`, `db`

### 3. 定期维护
- 定期检查"其他"分组
- 整理未归类的代理
- 规范化分组名称
- 清理过期代理

---

## ❓ 常见问题

### Q: 为什么我的代理被归类为"其他"？
**A:** 可能原因：
1. 代理名称不包含下划线
2. 下划线前的部分为空（如 `_test`）
3. 手动设置为"其他"

**解决方法：**
- 使用"批量修改分组"功能手动调整
- 或重命名代理为标准格式（需要在frpc端修改）

### Q: 修改分组后frps会覆盖吗？
**A:** 不会。本地数据库是主数据源，手动修改的分组不会被同步覆盖。

### Q: 可以删除分组吗？
**A:** 分组是动态的，当分组下没有代理时会自动消失。将代理移到其他分组即可。

### Q: 批量操作会影响在线代理吗？
**A:** 不会。分组修改只是数据库字段更新，不影响代理运行状态。

---

## 🚀 快捷操作

| 操作 | 快捷方式 |
|------|---------|
| 打开分组管理 | 点击"📁 管理分组"按钮 |
| 按分组过滤 | 使用顶部分组下拉框 |
| 批量选择分组 | 点击分组标题的复选框 |
| 刷新代理列表 | 点击"🔄 刷新"按钮 |
| 生成分组配置 | 过滤分组后点击"⚙️ 生成配置" |

---

## 📝 更新日志

### v1.1.0 (2025-11-08)
- ✅ 新增分组管理功能
- ✅ 支持自动分组识别
- ✅ 添加"其他"默认分组
- ✅ 实现批量修改分组
- ✅ 实现分组重命名
- ✅ 优化代理列表展示

---

如有疑问，请参考主文档或联系技术支持。

